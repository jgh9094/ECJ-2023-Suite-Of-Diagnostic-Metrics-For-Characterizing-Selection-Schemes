#!/bin/bash
########## Define Resources Needed with SBATCH Lines ##########

#SBATCH --time=5:00:00                # limit of wall clock time - how long the job will run (same as -t)
#SBATCH --array=210                 # number of jobs being created, each with its array id
#SBATCH --mem=3G                      # memory required per node - amount of memory (in gigs)
#SBATCH --job-name nov-exp            # you can give your job a name for easier identification (same as -J)
#SBATCH --account=devolab             # research group account being used

##################################
# Setup required dependencies
##################################
module load GCC/10.2.0; module load CUDA/11.1.1; module load Clang/11.0.1;

##################################
# Setup relevant directories
##################################
DATA_DIR=/mnt/gs21/scratch/herna383/ECJ-2023

##################################
# Setup random seed info
##################################
REPILCATE_OFFSET=0
PROBLEM_SEED_OFFSET=0
SEED_OFFSET=54000
SEED=$((SLURM_ARRAY_TASK_ID + PROBLEM_SEED_OFFSET + SEED_OFFSET + REPILCATE_OFFSET))

##################################
# Setup selection scheme
##################################

# novelty search == 5
SELECTION_SCHEME=5

##################################
# Setup diagnostic
##################################
EXPLOITATION_RATE=0
ORDERED_EXPLOITATION=1
CONTRADICTORY_OBJECTIVES=2
MULTIPATH_EXPLORATION=3

##################################
# Treatments
##################################

# T = 1
PARAMETER_1_MIN=1
PARAMETER_1_MAX=50

# T = 2
PARAMETER_2_MIN=51
PARAMETER_2_MAX=100

# T = 4
PARAMETER_3_MIN=101
PARAMETER_3_MAX=150

# T = 8
PARAMETER_4_MIN=151
PARAMETER_4_MAX=200

# T = 15
PARAMETER_5_MIN=201
PARAMETER_5_MAX=250

# T = 30
PARAMETER_6_MIN=251
PARAMETER_6_MAX=300

####################################################################

if [ ${SLURM_ARRAY_TASK_ID} -ge ${PARAMETER_1_MIN} ] && [ ${SLURM_ARRAY_TASK_ID} -le ${PARAMETER_1_MAX} ] ; then
  K=1

elif [ ${SLURM_ARRAY_TASK_ID} -ge ${PARAMETER_2_MIN} ] && [ ${SLURM_ARRAY_TASK_ID} -le ${PARAMETER_2_MAX} ] ; then
  K=2

elif [ ${SLURM_ARRAY_TASK_ID} -ge ${PARAMETER_3_MIN} ] && [ ${SLURM_ARRAY_TASK_ID} -le ${PARAMETER_3_MAX} ] ; then
  K=4

elif [ ${SLURM_ARRAY_TASK_ID} -ge ${PARAMETER_4_MIN} ] && [ ${SLURM_ARRAY_TASK_ID} -le ${PARAMETER_4_MAX} ] ; then
  K=8

elif [ ${SLURM_ARRAY_TASK_ID} -ge ${PARAMETER_5_MIN} ] && [ ${SLURM_ARRAY_TASK_ID} -le ${PARAMETER_5_MAX} ] ; then
  K=15

elif [ ${SLURM_ARRAY_TASK_ID} -ge ${PARAMETER_6_MIN} ] && [ ${SLURM_ARRAY_TASK_ID} -le ${PARAMETER_6_MAX} ] ; then
  K=30

else
  echo "${SEED} from ${PROBLEM} failed to launch" >> /mnt/ls15/scratch/users/herna383/ps-coh-failtolaunch.txt
fi

####################################################################

RUN_DIR=${DATA_DIR}/NOVELTY/EXPLOITATION_RATE/${SEED}/

# make a run directory
mkdir -p ${RUN_DIR}

echo "../../../../dia_world -SEED ${SEED} -DIAGNOSTIC ${EXPLOITATION_RATE} -SELECTION ${SELECTION_SCHEME} -OUTPUT_DIR ${RUN_DIR} -NOVEL_K ${K} > run.log" > ./cmd-coh.txt

../../../../dia_world -SEED ${SEED} -DIAGNOSTIC ${EXPLOITATION_RATE} -SELECTION ${SELECTION_SCHEME} -OUTPUT_DIR ${RUN_DIR} -NOVEL_K ${K}